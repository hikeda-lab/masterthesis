\section{スパイク発火シミュレータ}
研究室の実験で得られたスパイクデータを再現するために、スパイクデータのシ
ミュレータを作成した。シミュレータでは現実の実験データに近づけるため,実際の研究室で観測したス
パイクの波形データをテンプレートとして、次の事を再現した。
\begin{itemize}
 \item 複数のニューロンによるスパイクの発火列。
 \item 観測されるスパイク波形データに付加するノイズ。
 \item スパイク電位のバースト発火による減衰。
 \item 2つのスパイクの発火が実験データでの40点(0.0016s)以内に起きたときにおこる、重複したスパイクの波形データ。
\end{itemize}


シミュレータはテンプレート波形を設定した発火時間順に時間軸上に並べ、その後にテンプレート波形に条件を設けて、スパイク波形を作る。
シミュレータは以下のような手順でシミュレーションデータを生成する。

\begin{quote}
\begin{enumerate}
\item スパイク波形のテンプレートの用意。
\par
まず、異なる複数のニューロン$i$個（ニューロンの番号を1からi番とする）から発火した$i$個のスパイク波形データを用意する。
それぞれの波形データをテンプレートとし、それを波形データと同じく
      $\mathbf{template}^{(i)}$と40次元のベクトルで表す。
波形データは、異なるEVファイルから、スパイク波形を読み込むことで用意する。

\item 発火時間の設定。
\par
それぞれのニューロンからのスパイクの発火時間を設定する。発火時間には
ポアソン過程を仮定する。R言語の関数rpois()を使用して、平均値$\lambda_{Pois}$のポアソン分布から疑似乱数を生成する。
    
\begin{equation}
 \varDelta t_{j}^{(i)} \sim Pois(\lambda_{pois}) 
\end{equation}
これで全てのスパイクのISIが定義できたので、テンプレートを時間軸上に並べる事ができる
\item スパイク波形データの減衰。
\par 
スパイク波形をISIに基づい減衰させる。
\begin{equation}
 \mathbf{s} = (1 - \delta \exp(-\lambda \varDelta t_{i}^{(i))}) \mathbf{template^{(i)}} 
\end{equation}

$\delta,\lambda$は定数である。上式に基づいてスパイク電位を\fgref{spsort_idea_gensui}のようにISIが短ければ短いほど大きく減衰させる。
スパイクを一つ生成するごとに、$\lambda$にノイズを加えて減衰率を変化させる。
上式については、(Fee 1996)\cite{MS_Fee_1996}で提案されている。
本研究室でも(吉川　2004)\cite{Yoshikawa_2004}において、バースト発火時において、スパ
イク電位が減衰することが確認された。

また、$\lambda$にスパイクの発火の度にノイズを付加して、減衰率が発火ごとに変動させる。
ノイズは正規分布$N(0,\tau^{2})$から生成して、$\lambda$に付加する。
\begin{eqnarray}
 \lambda &=& \lambda + \epsilon \\
 \epsilon &\sim& N(0,\tau_{1}^{2})
  \label{eq_noise_lambda}
\end{eqnarray}

\item スパイク波形データへのノイズの付加。
\par
ここで、スパイク波形にノイズを加える。ノイズは正規分布から疑似乱数をスパイク波形のデータ数
(40個)を生成する。
\begin{equation}
 \mathbf{noise} = n_{1},n_{2},\dots,n_{39} \sim N(\mu,\tau_{2}^{2})
  \label{eq_noise_spwave}
\end{equation}
\begin{equation}
 \mathbf{S_{i}} \leftarrow \mathbf{S_{i}} + \mathbf{noise}
\end{equation}

\item スパイク波形同士の重複の再現。
\par
このように各スパイクの発火時間とスパイク波形データを作った後に、
各スパイクの発火時間をチェックし、もし2つのスパイク時間の間隔がスパイク
波形データ一つ分（$0.0016s$）
以内にであったときには、スパイクが重複したものとして重複したスパイク波形
を作成し、スパイクを重複したものに置き換える。

仮に、2つのスパイク波形$\mathbf{S}_{a},\mathbf{S}_b$が重複したとすると、
$\mathbf{S}_{a}=(a_1,a_2,\dots,a_40),\mathbf{S}_b=(b_1,b_2,\dots,b_{40})$のそれぞれの波形の
重複した後の波形$\mathbf{overlapped} \
      \mathbf{S}_{a} = (a'_1,a'_2,\dots,a'_40),\mathbf{overlapped} \
      \mathbf{S}_{b} = (b'_1,b'_2,\dots,b'_40)$
は、
\begin{eqnarray}
 a'_i &=&
  max(a_i,b_i) \\
 b'_i &=&
  max(a_i,b_i) \\
i=1 &\sim& 40 
\end{eqnarray}
として、重複が生じた区間(40点)におけるデータにおいて、
      $\mathbf{S}_{1},\mathbf{S}_{2}$
の大きい方のスパイク波形のデータを重複したスパイク波形として残すようにする。
\end{enumerate}

\end{quote}
