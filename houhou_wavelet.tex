\section{ウェーブレット解析によるスパイクソーティング}
ウェーブレット解析によるスパイクソーティングは、
スパイクの特徴を抽出し、スパイク波形の判別をするという2
つのステップからなる。
\fgref{spsort_idea_wavelet}にスパイクソーティングのイメージ図を載せた。
一段目(Spikes)は３種類のスパイク波形のテンプレートである。
二段目(Feature extraction)は波形の特徴を抽出できる特徴空間の作成。
三段目(k-means clutering)は特徴空間でのクラスタリング（判別）である。

ウェーブレット解析によるスパイクソーティングの手順は次のようになる。
\begin{enumerate}
 \item 各スパイク波形データをウェーブレット変換する。(Feature extraction)
 \item クラスタリングに適した基底関数を選ぶ。(Feature extraction)
 \item 選んだ基底関数のから作られた特徴空間上のスパイク列をクラスタリングを行う。(k-means clutering)
\end{enumerate}


各手順について詳しく記す。
\begin{quote}
\begin{enumerate}
\item スパイク波形データのウェーブレット変換。
\par
各スパイク波形データ$\mathbf{S}_{0},\mathbf{S}_{1},\dots,\mathbf{S}_{n}$を
それぞれ３次のスプライン関数で補完して各スパイク波形データを40点のデータから64点
のデータ$\mathbf{S}_{0}',\mathbf{S}_{1}',\mathbf{S}_{n}'$にする。
このスプライン補完は、多重解像度解析では、$2^{x}$のデータ点が必要だから
      である。
\par
次に、レベル8の多重解像度解析による64点で補完した各スパイク波形データ
$\mathbf{S}_{0}',\mathbf{S}_{1}',\mathbf{S}_{n}'$
をウェーブレット変換する。
各スパイク波形のデータを
$\mathbf{w}=\{ \mathbf{w_{0}},\mathbf{w_{1}}, \dots \}$と表す。
ウェーブレット関数には、N=8のDaubechiesのウェーブレット関数\fgref{Daubechies}を選んだ。
ウェーブレット変換されたスパイク波形は
$\mathbf{w}_{(i)}=\{ w_{0}, w_{1}, \dots ,w_{63}\}$
64次元のデータに変換される。
ここで、$w_{0}, w_{1}, \dots ,w_{63}$は、ウェーブレットの基底関数の各係
      数である。
つまり、一つのスパイク波形$\mathbf{S}'$は、ウェーブレットの基底関数$\phi_{1}
      \sim \phi_{64}$
を用いて、
\begin{eqnarray}
\mathbf{S}' = \sum_{i=0}^{63} w_{i} \phi_{i}  
\end{eqnarray}
と表される。
\item 基底関数の選択。
\par
64個のウェーブレット変換の基底関数から、クラスタリングに適した基底関数を選ぶ。
各基底関数の得点$score_i,i=1\sim64$を次のように各係数の標準偏差で定義し、この得点が高ければ高いほど基底関数をクラスタリングに適した基底関数と考える。
\begin{eqnarray}
 score_i &=& \frac{1}{n-1} \sum_{j=1}^{n} (w_{i} - \Bar{w})^{2} \\
 \label{eq:wavelet_sd}
 \Bar{w} &=& \frac{1}{n} \sum_{j=1}^{n} w_{i}
\end{eqnarray}
得点を基底関数の係数の標準偏差で定義したのは、標準偏差が大きい基底関数ならば特徴空間でのスパイクの分布が
広く、クラスタリングの際に複数のクラスターができている可能性が大きいだろ
うと考えたからである。
この得点の高い上位10個の基底関数で特徴空間を構成する。

%\subsection{k-means clustering}
\item クラスタリング。
\par
10次元の特徴空間上のスパイク列をk-means法でクラスタリングする。
k-means法とは、最も簡単なクラスタリングの手法の一つである。
与えられた多次元のデータを、クラスタの平均を計算して、k個のクラスターに
判別する。
k-means法では、特徴空間のスパイク列を何個のクラスターに分割するか
kの値をユーザが入力しなければ
ならない。
本研究では、スパイク発火シミュレータで設定したニューロンの個数と同じ個数
にクラスターを設定して、特徴空間のスパイク列を分割する。
実際の実験データを本研究の手法でスパイクソーティングする場合は、スパイク
列の波形や特徴空間上のスパイク列を観察して、ユーザがクラスターの数を設定
する事になる。
その意味では、本研究の手法はsemi-automaticな手法と言える。

\end{enumerate}
\end{quote}


ウェーブレット解析とk-means法については、(付録
\ref{sec:wavelet},\ref{sec:k-means})にまとめておいた。