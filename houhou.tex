現在の研究室のスパイクの解析は実験中の実験者によるスパイクソーティングの結果を基に行っている。
本研究では、実験後に実験で得たスパイクデータを基に(オフライン)スパイクソーティンングを行う手法を開発した。
実際にスパイクソーティングが必要となる複数のニューロンからのスパイクの発火を再現した
スパイクシミュレータを開発し、アルゴリズムのパフォーマンスを調べた。
本研究に必要なプログラムはgcc,R言語で開発した。
使用した計算機については、\tbref{tb:machines}にまとめた。

\section{実験システム}
本研究室の実験システムを\fgref{jikken}に示す。
実験は、被験動物に視覚刺激を提示し、神経細胞（以下、ニューロン）の活動電位を単一電極で記録して行われる。
単一電極で記録された活動電位はアンプで約1000万倍に増幅し、
300$\sim$5000Hzのバンドパスフィルタをかけられる。その後活動電位は、AD変換器で25kHzでサンプリングし、12bitに量子化された離散データに変換される。
この時、スパイク判別用PC（SPCODER）で離散データからスパイク部分が検出される。
本研究室の実験システムでは,
このSPCODERを使って、実験中に実験者が活動電位に閾値を設定し、活動電位からスパイクを検出し、
、実験者自信がスパイク波形の特徴を自分の目で判別して、
半分手作業にてスパイクソーティング（オンライン$\cdot$スパイクソーティング）
を行っている(森屋　2004)\cite{Moriya_2004}。
スパイクソーティングの結果と各スパイクの波形データ、各スパイクの発火時間
はEVファイル(*.ev)というバイナリファイルとして記録され、それぞれ実験の種類による名前がつけられている。

\section{スパイクデータ}
研究室で保存されているスパイクのデータは、ニューロンの活動電位における各スパイクの波形データとそのときのスパイクの発火時間である。
一つのスパイク波形のデータは40点のサンプルデータで保存される。
実際の研究室で記録したスパイクのスパイク波形の例を\fgref{fig:simu_1_temps}に示す。
横軸が時間を表すサンプルポイントである。サンプリング周波数が25kHz
であるので、1点が $0.00004$(s)。スパイク波形１つは、40点なので $0.0016$(s)
となる。縦軸はスパイクの電位を表している。細胞外記録法では、この値はニューロンから離れた単一電極で測定した活動電位をアンプで増幅したものなので、実際の神経細胞のスパイクの電位の値ではない。
しかしながら、この値は実際のスパイクの電位を反映したものと言える。

\section{スパイクデータの表記について}
以降からスパイクデータを次のようにする。


\begin{quote}
（１）実際に実験で得られたデータのように、ニューロンの数がいくつか、
スパイクがどのニューロンから発火したものかが区別できない場合。
\begin{itemize}
 \item スパイクの数$n$
 \item 順に発火したスパイクの発火時間$t_{0},t_{1},\dots,t_{n}$(秒)
 \item 順に発火したスパイクのスパイク間隔時間(ISI)$\varDelta t_{1},\varDelta t_{2},\dots \varDelta t_{n}$(秒)
 \item 順に発火したスパイクの波形データ$\mathbf{S}_{1},\mathbf{S}_{2},\dots \mathbf{S}_{n}$
 \item 各スパイクのラベル$C=\{C_{1},C_{2}\dots,C_{n}\}$
\end{itemize}
実験でn個のスパイク列を観測したとする。

観測したスパイクについて、その１発目に発火したスパイクの発火時間を
$t_{0}$で表し、k発目のスパイクの発火時間を$t_{k}$とする。
観測したスパイクの発火時間については全体として、$t_{0},t_{1},\dots,t_{n-1}$とする。
各スパイクのスパイク間隔時間(inter-spike interval time, 以下、ISI)も定義しておく、
ISIは、特定のニューロンから発火した連続したスパイクに関して、その隣あったスパイクの発火時間の時間差である。
\begin{equation}
 \varDelta t_{k-1} = t_{k} - t_{k-1}
\end{equation}
と定義される。
実験では、スパイクデータが
スパイクの波形データについては、波形データが40個のサンプル点で表されてい
るので、一つのスパイク波形データを40次元のベクトルで表す。k発目に発火し
たスパイクのスパイク波形データを$\mathbf{S}_{k}$とすると、
$\mathbf{S}_{k}=\left( s_{0},s_{1},\dots,s_{39} \right)$となる。
観測したスパイク波形のデータは、発火した順に$\mathbf{S}_{1},\mathbf{S}_{2},\dots,\mathbf{S}_{n}$とする。
仮にこのスパイク列がk個のニューロンから発火したものとする。
i番目のスパイクに対し、$C_{i}=X(X=1,2,\dots,n)$とスパイクを発火したニューロ
ンの番号を割り当てる。
実際には、観測したスパイクデータでは、各スパイクがどのニューロンが発火し
たスパイクかは分からない。
スパイクソーティングでは、
i番目のスパイクのラベル$C_{i}$に、アルゴリズムによって番号を割り当てる。\\



（２）スパイク発火シミュレータ（後述）で作ったスパイクデータのように、
スパイクがどのニューロンから発火したものか区別がつく場合。
スパイク列がk個のニューロンから発火したものとし、
\begin{itemize}
 \item ニューロンの番号$i,(i=1,2,3\dots k)$
 \item スパイクの数$n$,ニューロン$i$が発火したスパイクの数$n_{i}$
 \item ニューロン$i$が発火したスパイクの数$n_{i}$
 \item ニューロン$i$が順に発火したスパイクの発火時間データ
       $t_{0}^{(i)},t_{1}^{i},\dots,t_{n_{i}^{(i)}}$(秒)
 \item ニューロン$i$が順に発火したスパイクのスパイク間隔時間
       (ISI)$\varDelta t_{1}^{(i)},\varDelta t_{2}^{(i)},\dots,\varDelta
       t_{n_{i}}^{(i)}$(秒)
 \item ニューロン$i$が順に発火したスパイクのの波形データ
$\mathbf{S}_{1}^{(i)},\mathbf{S}_{2}^{(i)},\cdots,\mathbf{S}_{n_{i}}^{(i)}$
 %\item 各スパイクに対するニューロンの番号$C=\{C_{0},C_{1},\dots,C_{n}\}$
\end{itemize}
i番目のニューロンについて、その１発目に発火したスパイクの発火時間を
$t_{0}^{i}$で表し、k発目のスパイクの発火時間を$t_{k}^{(i)}$とする。
i番目のニューロンが発火したスパイクの発火時間については全体として、
$t_{0}^{(i)},t_{1}^{(i)},\dots$とする。
i番目のニューロンから発火されたスパイク波形のデータも、発火した順に
$\mathbf{S}_{0}^{(i)},\mathbf{S}_{1}^{(i)},\dots$とする。
%仮にこのスパイク列がk個のニューロンから発火したものとする。i番目のスパイクに対し、$C_{i}=0,1,\dots,k-$とスパイクを発火したニューロンの番号を割り当てる。スパイク発火シミュレータ

\end{quote}
